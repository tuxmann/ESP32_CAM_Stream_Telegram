TELEGRAM PHOTO SENDING TROUBLESHOOTING GUIDE
============================================

PROBLEM: Messages work, but photos don't send
----------------------------------------------

This is one of the most common ESP32-CAM issues. Here's how to fix it:


SOLUTION 1: Use the Fixed Code (RECOMMENDED)
---------------------------------------------
I've created an improved version with these fixes:
âœ“ Lower resolution photos (800x600 instead of 1600x1200)
âœ“ Better memory management
âœ“ Improved error handling
âœ“ More detailed serial output for debugging

Upload the file: ESP32_CAM_Telegram_FIXED.ino


SOLUTION 2: Check Serial Monitor Output
----------------------------------------
When you request a photo, open Serial Monitor (115200 baud) and watch for:

GOOD signs:
- "Photo captured: XXXXX bytes"
- "Connection successful!"
- "Sending image data..."
- "Sent: X/Y bytes"
- "SUCCESS: Photo sent to Telegram!"

BAD signs (and fixes):
- "Camera capture failed" â†’ Power supply issue
- "Connection to api.telegram.org failed" â†’ WiFi/Internet issue
- "Photo may be too large" â†’ Use fixed code (lower resolution)
- Response contains "error_code":413 â†’ Photo too large
- Response contains "error_code":400 â†’ Bot token or chat ID wrong
- No response after "Sending image data" â†’ Timeout/memory issue


SOLUTION 3: Common Fixes to Try
--------------------------------

A) Reduce Photo Resolution:
   In the camera config section, change:
   config.frame_size = FRAMESIZE_VGA;  // Try this (640x480)
   // or
   config.frame_size = FRAMESIZE_CIF;  // Or this (400x296)

B) Increase JPEG Quality Number (lower quality, smaller file):
   config.jpeg_quality = 20;  // Higher = worse quality = smaller file

C) Check Power Supply:
   - MUST use external 5V power supply (not FTDI programmer)
   - Need at least 1A, preferably 1.5-2A
   - Flash LED draws a lot of power
   - Brownout = photo fails

D) Verify Credentials:
   Double-check in your code:
   - BOTtoken is correct (no spaces, complete token)
   - CHAT_ID is YOUR chat ID (numeric)
   
   Test your bot token in a browser:
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getMe
   
   Should return JSON with your bot info. If error â†’ wrong token.

E) Check Internet Connection:
   - ESP32 can connect to WiFi but not internet
   - Try accessing: https://api.telegram.org from your network
   - Check if router blocks HTTPS traffic
   - Try different WiFi network


SOLUTION 4: Alternative Photo Sending Method
---------------------------------------------

If the main method still fails, try the alternative method:

In the fixed code, find this section in handleNewMessages():

    if (text == "/photo") {
      bot.sendMessage(chat_id, "ðŸ“¸ Taking photo, please wait...", "");
      
      // COMMENT OUT THIS LINE:
      // String result = sendPhotoTelegram();
      
      // UNCOMMENT THESE LINES:
      bool result = sendPhotoTelegramAlt();
      if(result) {
        bot.sendMessage(chat_id, "âœ… Photo sent!", "");
      } else {
        bot.sendMessage(chat_id, "âŒ Failed to send photo", "");
      }
    }

Also uncomment the sendPhotoTelegramAlt() function near line 180.


SOLUTION 5: Test Individual Components
---------------------------------------

A) Test Bot Token:
   Send /test command - if you get response, bot works

B) Test Camera:
   Look at local stream (http://[IP]) - if it works, camera is fine

C) Test Photo Capture:
   Add this after camera init in setup():
   
   camera_fb_t * fb = esp_camera_fb_get();
   if(fb) {
     Serial.printf("Test photo: %d bytes\n", fb->len);
     esp_camera_fb_return(fb);
   }

D) Test Internet:
   Add this in setup():
   
   WiFiClientSecure testClient;
   testClient.setInsecure();
   if(testClient.connect("api.telegram.org", 443)) {
     Serial.println("âœ“ Can reach Telegram servers");
     testClient.stop();
   } else {
     Serial.println("âœ— Cannot reach Telegram servers");
   }


SOLUTION 6: Memory Issues
--------------------------

If Serial Monitor shows "Guru Meditation Error" or random reboots:

A) Reduce frame buffer count:
   config.fb_count = 1;  // Use only 1 buffer

B) Enable PSRAM:
   In Arduino IDE â†’ Tools â†’ PSRAM: "Enabled"
   
   Verify with:
   if(psramFound()) {
     Serial.println("PSRAM OK");
   }

C) Stop web streaming before taking photo:
   In handleNewMessages(), before taking photo:
   server.stop();  // Stop stream
   // ... take photo ...
   server.begin(); // Restart stream


SOLUTION 7: Known ESP32-CAM Board Issues
-----------------------------------------

Some ESP32-CAM boards have hardware issues:

A) Poor voltage regulator:
   - Use external 5V supply with good regulation
   - Add 470ÂµF capacitor between 5V and GND
   - Avoid long/thin wires to power supply

B) Poor camera cable:
   - Reseat the camera ribbon cable
   - Make sure blue side faces UP
   - Press connector firmly until it clicks

C) Faulty flash LED:
   - Try disabling flash completely:
     // digitalWrite(FLASH_LED_PIN, HIGH);  // Comment this out


DIAGNOSTIC CHECKLIST
--------------------

Go through these in order:

â–¡ Upload the FIXED code version
â–¡ Open Serial Monitor at 115200 baud
â–¡ Verify WiFi connects successfully
â–¡ Check "PSRAM found" message
â–¡ Look at local stream to confirm camera works
â–¡ Send /test to bot (should get response)
â–¡ Send /status to bot (check free memory)
â–¡ Request /photo and watch Serial Monitor closely
â–¡ Note any error messages
â–¡ Check power supply is adequate (1A+ on 5V)
â–¡ Verify bot token in browser: 
  https://api.telegram.org/bot<TOKEN>/getMe
â–¡ Confirm CHAT_ID is correct numeric value
â–¡ Try from different WiFi network


STILL NOT WORKING?
------------------

If after all this photos still don't send, provide these details:

1. What does Serial Monitor show when you request /photo?
2. What is the photo size in bytes? (check serial output)
3. Do you see "SUCCESS: Photo sent to Telegram!" in serial?
4. What error messages appear?
5. Does web streaming work?
6. What is your free heap memory? (send /status)
7. Is PSRAM detected?
8. Are you using external 5V power supply?

With this info, I can provide more specific help!


EXPECTED BEHAVIOR
-----------------

When working correctly, you should see:

1. Send /photo command in Telegram
2. Bot replies: "ðŸ“¸ Taking photo, please wait..."
3. Serial Monitor shows:
   - "Command received: /photo"
   - "Preparing to send photo to Telegram..."
   - "Photo captured: XXXXX bytes, 800x600"
   - "Connecting to api.telegram.org"
   - "Connection successful!"
   - "Sending image data..."
   - "Sent: X/Y bytes" (progress updates)
   - "Image data sent, waiting for response..."
   - "SUCCESS: Photo sent to Telegram!"
4. Photo appears in Telegram chat
5. Bot may send confirmation message

Total time: 5-15 seconds depending on WiFi speed.
